var app=angular.module("app",["ngRoute","toastr"]);angular.module("app").controller("ApplicationCtrl",["$scope","UserSvc","$window","toastr",function(e,n,t,o){t.sessionStorage.token&&n.checkUser().then(function(n){e.currentUser=n}),e.logout=function(){n.logout(),e.currentUser=!1,o.info("You have been logged out","Information")},e.$on("login",function(n,t){e.currentUser=t})}]),angular.module("app").controller("AnswerCtrl",["$scope","AnswersSvc","QuestionsSvc","$location","toastr",function(e,n,t,o,s){e.editBody="",e.postAnswer=function(n){e.answers.push({username:e.currentUser.username,body:n,votes:0});var s={_id:e.question._id,answers:e.answers};t.update(o.path(),s).success(function(n){e.answers=n.answers})},e.deleteAnswer=function(t,o){console.log(t,o),n.deleteAnswer(t,o).success(function(n){e.answers=n})},e.editAnswer=function(n,s){e.answers.forEach(function(e){e._id===n&&(e.body=s)}),console.log(e.answers);var r={_id:e.question._id,answers:e.answers};t.update(o.path(),r).success(function(n){e.answers=n.answers})},e.vote=function(n,r){if(e.currentUser){e.answers.forEach(function(e){e._id===n&&(e.votes=r)});var i={_id:e.question._id,answers:e.answers};t.update(o.path(),i).success(function(){e.message="Answer Updated!"})}else s.warning("You must log in to vote","Warning")},t.fetchOne(o.path()).success(function(n){e.answers=n.answers,e.question=n})}]).directive("ngReallyClick",[function(){return{restrict:"A",link:function(e,n,t){n.bind("click",function(){var n=t.ngReallyMessage;n&&confirm(n)&&e.$apply(t.ngReallyClick)})}}}]),angular.module("app").service("AnswersSvc",["$http",function(e){this.create=function(n,t){return e.post("/api/questions"+n,t)},this.fetch=function(n){return e.get("/api/questions"+n)},this.deleteAnswer=function(n,t){return e["delete"]("api/questions/"+n+"/"+t)}}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location","$window",function(e,n,t){e.login=function(o,s){n.login(o,s).then(function(n){e.$emit("login",n),t.path("/")},function(){e.errorMsg="Incorrect username/password"})}}]),angular.module("app").controller("QuestionDetailCtrl",["$scope","QuestionsSvc","$location",function(e,n,t){n.fetchOne(t.path()).success(function(n){e.question=n})}]),angular.module("app").controller("QuestionsCtrl",["$scope","QuestionsSvc","$location",function(e,n,t){e.askQuestion=function(){n.create({username:e.username,title:e.questionTitle,body:e.questionBody}).success(function(n){e.questions.unshift(n),e.questionBody=null,e.questionTitle=null,t.path("/")}).error(function(){e.errorMsg="All fields must be filled out"})},n.fetch().success(function(n){e.questions=n})}]),angular.module("app").service("QuestionsSvc",["$http",function(e){this.fetch=function(){return e.get("/api/questions/")},this.create=function(n){return e.post("/api/questions",n)},this.fetchOne=function(n){return e.get("/api/questions/"+n)},this.update=function(n,t){return e.put("/api/questions/"+n,t)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc","$location",function(e,n,t){e.register=function(o,s){n.register(o,s).then(function(n){e.$emit("login",n),t.path("/")})}}]),app.config(["$routeProvider",function(e){e.when("/",{controller:"QuestionsCtrl",templateUrl:"questions.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}).when("/ask",{controller:"QuestionsCtrl",templateUrl:"ask.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/:id",{controller:"QuestionDetailCtrl",templateUrl:"questionDetail.html"})}]),angular.module("app").service("UserSvc",["$http","$window",function(e,n){var t=this;t.getUser=function(){return e.get("/api/users").then(function(e){return e.data})},t.login=function(o,s){return e.post("/api/sessions",{username:o,password:s}).then(function(o){return console.log(o),t.token=o.data.token,n.sessionStorage.token=o.data,e.defaults.headers.common["X-Auth"]=o.data,t.getUser()})},t.logout=function(){delete n.sessionStorage.token,delete e.defaults.headers.common["X-Auth"]},t.register=function(n,o){return e.post("/api/users",{username:n,password:o}).then(function(){return t.login(n,o)})},t.checkUser=function(){return n.sessionStorage.token?(e.defaults.headers.common["X-Auth"]=n.sessionStorage.token,t.getUser()):void 0}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIkFwcGxpY2F0aW9uLmN0cmwuanMiLCJhbnN3ZXIuY3RybC5qcyIsImFuc3dlci5zdmMuanMiLCJsb2dpbi5jdHJsLmpzIiwicXVlc3Rpb25EZXRhaWwuY3RybC5qcyIsInF1ZXN0aW9ucy5jdHJsLmpzIiwicXVlc3Rpb25zLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIlVzZXJTdmMiLCIkd2luZG93IiwidG9hc3RyIiwic2Vzc2lvblN0b3JhZ2UiLCJ0b2tlbiIsImNoZWNrVXNlciIsInRoZW4iLCJ1c2VyIiwiY3VycmVudFVzZXIiLCJsb2dvdXQiLCJpbmZvIiwiJG9uIiwiXyIsIkFuc3dlcnNTdmMiLCJRdWVzdGlvbnNTdmMiLCIkbG9jYXRpb24iLCJlZGl0Qm9keSIsInBvc3RBbnN3ZXIiLCJhbnN3ZXJCb2R5IiwiYW5zd2VycyIsInB1c2giLCJ1c2VybmFtZSIsImJvZHkiLCJ2b3RlcyIsInF1ZXN0aW9uIiwiX2lkIiwidXBkYXRlIiwicGF0aCIsInN1Y2Nlc3MiLCJkZWxldGVBbnN3ZXIiLCJxdWVzdElEIiwiYW5zSUQiLCJjb25zb2xlIiwibG9nIiwiZWRpdEFuc3dlciIsImlkIiwiZm9yRWFjaCIsIml0ZW0iLCJ2b3RlIiwibWVzc2FnZSIsIndhcm5pbmciLCJmZXRjaE9uZSIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiYmluZCIsIm5nUmVhbGx5TWVzc2FnZSIsImNvbmZpcm0iLCIkYXBwbHkiLCJuZ1JlYWxseUNsaWNrIiwic2VydmljZSIsIiRodHRwIiwidGhpcyIsImNyZWF0ZSIsImFuc3dlciIsInBvc3QiLCJmZXRjaCIsImdldCIsImxvZ2luIiwicGFzc3dvcmQiLCIkZW1pdCIsImVycm9yTXNnIiwiYXNrUXVlc3Rpb24iLCJ0aXRsZSIsInF1ZXN0aW9uVGl0bGUiLCJxdWVzdGlvbkJvZHkiLCJxdWVzdGlvbnMiLCJ1bnNoaWZ0IiwiZXJyb3IiLCJwdXQiLCJyZWdpc3RlciIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwic3ZjIiwiZ2V0VXNlciIsInJlc3BvbnNlIiwiZGF0YSIsInZhbCIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxPQUNBLFVBQ0EsVUNGQUQsU0FBQUMsT0FBQSxPQUNBQyxXQUFBLG1CQUFBLFNBQUEsVUFBQSxVQUFBLFNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQUQsRUFBQUUsZUFBQUMsT0FDQUosRUFBQUssWUFDQUMsS0FBQSxTQUFBQyxHQUNBUixFQUFBUyxZQUFBRCxJQUlBUixFQUFBVSxPQUFBLFdBQ0FULEVBQUFTLFNBQ0FWLEVBQUFTLGFBQUEsRUFDQU4sRUFBQVEsS0FBQSwyQkFBQSxnQkFHQVgsRUFBQVksSUFBQSxRQUFBLFNBQUFDLEVBQUFMLEdBQ0FSLEVBQUFTLFlBQUFELE9DaEJBWCxRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsY0FBQSxTQUFBLGFBQUEsZUFBQSxZQUFBLFNBQUEsU0FBQUMsRUFBQWMsRUFBQUMsRUFBQUMsRUFBQWIsR0FDQUgsRUFBQWlCLFNBQUEsR0FFQWpCLEVBQUFrQixXQUFBLFNBQUFDLEdBQ0FuQixFQUFBb0IsUUFBQUMsTUFDQUMsU0FBQXRCLEVBQUFTLFlBQUFhLFNBQ0FDLEtBQUFKLEVBQ0FLLE1BQUEsR0FHQSxJQUFBQyxJQUNBQyxJQUFBMUIsRUFBQXlCLFNBQUFDLElBQ0FOLFFBQUFwQixFQUFBb0IsUUFFQUwsR0FBQVksT0FBQVgsRUFBQVksT0FBQUgsR0FDQUksUUFBQSxTQUFBSixHQUNBekIsRUFBQW9CLFFBQUFLLEVBQUFMLFdBSUFwQixFQUFBOEIsYUFBQSxTQUFBQyxFQUFBQyxHQUVBQyxRQUFB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QSxTQUFBNEUsR0FLQSxNQUpBbEQsU0FBQUMsSUFBQWlELEdBQ0FKLEVBQUExRSxNQUFBOEUsRUFBQUQsS0FBQTdFLE1BQ0FILEVBQUFFLGVBQUFDLE1BQUE4RSxFQUFBRCxLQUNBM0IsRUFBQTZCLFNBQUFDLFFBQUFDLE9BQUEsVUFBQUgsRUFBQUQsS0FDQUgsRUFBQUMsYUFJQUQsRUFBQXJFLE9BQUEsaUJBRUFSLEdBQUFFLGVBQUFDLFlBRUFrRCxHQUFBNkIsU0FBQUMsUUFBQUMsT0FBQSxXQUlBUCxFQUFBTCxTQUFBLFNBQUFwRCxFQUFBeUMsR0FDQSxNQUFBUixHQUFBSSxLQUFBLGNBQ0FyQyxTQUFBQSxFQUFBeUMsU0FBQUEsSUFDQXhELEtBQUEsV0FDQSxNQUFBd0UsR0FBQWpCLE1BQUF4QyxFQUFBeUMsTUFJQWdCLEVBQUF6RSxVQUFBLFdBQ0EsTUFBQUosR0FBQUUsZUFBQUMsT0FDQWtELEVBQUE2QixTQUFBQyxRQUFBQyxPQUFBLFVBQUFwRixFQUFBRSxlQUFBQyxNQUNBMEUsRUFBQUMsV0FGQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcblx0XCJuZ1JvdXRlXCIsXG5cdCd0b2FzdHInXG5dKSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIFVzZXJTdmMsICR3aW5kb3csIHRvYXN0cikge1xuXHRpZiAoJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbikgeyBcblx0XHRVc2VyU3ZjLmNoZWNrVXNlcigpXG5cdFx0LnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcblx0XHRcdCRzY29wZS5jdXJyZW50VXNlciA9IHVzZXJcblx0XHR9KVxuXHR9XG5cblx0JHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRVc2VyU3ZjLmxvZ291dCgpXG5cdFx0JHNjb3BlLmN1cnJlbnRVc2VyID0gZmFsc2Vcblx0XHR0b2FzdHIuaW5mbygnWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0JywgJ0luZm9ybWF0aW9uJylcblx0fVxuXHRcblx0JHNjb3BlLiRvbignbG9naW4nLCBmdW5jdGlvbiAoXywgdXNlcikge1xuXHRcdCRzY29wZS5jdXJyZW50VXNlciA9IHVzZXJcblx0fSlcbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignQW5zd2VyQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIEFuc3dlcnNTdmMsIFF1ZXN0aW9uc1N2YywgJGxvY2F0aW9uLCB0b2FzdHIpIHtcblx0JHNjb3BlLmVkaXRCb2R5ID0gJydcblxuXHQkc2NvcGUucG9zdEFuc3dlciA9IGZ1bmN0aW9uIChhbnN3ZXJCb2R5KSB7XG5cdFx0JHNjb3BlLmFuc3dlcnMucHVzaCh7XG5cdFx0XHR1c2VybmFtZTogJHNjb3BlLmN1cnJlbnRVc2VyLnVzZXJuYW1lLFxuXHRcdFx0Ym9keTogXHQgIGFuc3dlckJvZHksXG5cdFx0XHR2b3RlczogICAgMCBcblx0XHR9KVxuXG5cdFx0dmFyIHF1ZXN0aW9uID0geyBcblx0XHRcdF9pZDogJHNjb3BlLnF1ZXN0aW9uLl9pZCwgXG5cdFx0XHRhbnN3ZXJzOiAkc2NvcGUuYW5zd2Vyc1xuXHRcdH1cblx0XHRRdWVzdGlvbnNTdmMudXBkYXRlKCRsb2NhdGlvbi5wYXRoKCksIHF1ZXN0aW9uKVxuXHRcdC5zdWNjZXNzKGZ1bmN0aW9uIChxdWVzdGlvbikge1xuXHRcdFx0JHNjb3BlLmFuc3dlcnMgPSBxdWVzdGlvbi5hbnN3ZXJzXG5cdFx0fSlcblx0fVxuXG5cdCRzY29wZS5kZWxldGVBbnN3ZXIgPSBmdW5jdGlvbihxdWVzdElELCBhbnNJRCkge1xuXHRcdC8vIHRoaXMudm90ZSArPSBhbW91bnRcblx0XHRjb25zb2xlLmxvZyhxdWVzdElELCBhbnNJRClcblx0XHRBbnN3ZXJzU3ZjLmRlbGV0ZUFuc3dlcihxdWVzdElELCBhbnNJRClcblx0XHQuc3VjY2VzcyhmdW5jdGlvbiAoYW5zd2Vycykge1xuXHRcdFx0JHNjb3BlLmFuc3dlcnMgPSBhbnN3ZXJzXG5cdFx0fSlcblx0fVxuXG5cdCRzY29wZS5lZGl0QW5zd2VyID0gZnVuY3Rpb24gKGlkLCBlZGl0Qm9keSkge1xuXHRcdCRzY29wZS5hbnN3ZXJzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdGlmKGl0ZW0uX2lkID09PSBpZCkge1xuXHRcdFx0XHRpdGVtLmJvZHkgPSBlZGl0Qm9keVxuXHRcdFx0XHQvLyBjb25zb2xlLmxvZyhlZGl0Qm9keSlcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0Y29uc29sZS5sb2coJHNjb3BlLmFuc3dlcnMpXG5cblx0XHR2YXIgcXVlc3Rpb24gPSB7XG5cdFx0XHRfaWQ6ICRzY29wZS5xdWVzdGlvbi5faWQsXG5cdFx0XHRhbnN3ZXJzOiAkc2NvcGUuYW5zd2Vyc1xuXHRcdH1cblxuXHRcdFF1ZXN0aW9uc1N2Yy51cGRhdGUoJGxvY2F0aW9uLnBhdGgoKSwgcXVlc3Rpb24pXG5cdFx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHF1ZXN0aW9uKSB7XG5cdFx0XHQkc2NvcGUuYW5zd2VycyA9IHF1ZXN0aW9uLmFuc3dlcnNcblx0XHR9KVxuXHR9XG5cblx0JHNjb3BlLnZvdGUgPSBmdW5jdGlvbiAoaWQsIHZvdGUpIHtcblx0XHRpZiAoJHNjb3BlLmN1cnJlbnRVc2VyKSB7XG5cblx0XHRcdCRzY29wZS5hbnN3ZXJzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0aWYoaXRlbS5faWQgPT09IGlkKSB7XG5cdFx0XHRcdFx0aXRlbS52b3RlcyA9IHZvdGVcblx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZyhlZGl0Qm9keSlcblx0XHRcdFx0fVxuXHRcdFx0fSlcblxuXHRcdFx0dmFyIHF1ZXN0aW9uID0ge1xuXHRcdFx0XHRfaWQ6ICRzY29wZS5xdWVzdGlvbi5faWQsXG5cdFx0XHRcdGFuc3dlcnM6ICRzY29wZS5hbnN3ZXJzXG5cdFx0XHR9XG5cblx0XHRcdFF1ZXN0aW9uc1N2Yy51cGRhdGUoJGxvY2F0aW9uLnBhdGgoKSwgcXVlc3Rpb24pXG5cdFx0XHQuc3VjY2VzcyhmdW5jdGlvbiAocXVlc3Rpb24pIHtcblx0XHRcdFx0JHNjb3BlLm1lc3NhZ2UgPSBcIkFuc3dlciBVcGRhdGVkIVwiXG5cdFx0XHR9KVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0b2FzdHIud2FybmluZygnWW91IG11c3QgbG9nIGluIHRvIHZvdGUnLCAnV2FybmluZycpXG5cdFx0fVxuXG5cdH1cblxuXHRRdWVzdGlvbnNTdmMuZmV0Y2hPbmUoJGxvY2F0aW9uLnBhdGgoKSlcblx0LnN1Y2Nlc3MoZnVuY3Rpb24gKHF1ZXN0aW9uKSB7XG5cdFx0ICRzY29wZS5hbnN3ZXJzID0gcXVlc3Rpb24uYW5zd2Vyc1xuXHRcdCAkc2NvcGUucXVlc3Rpb24gPSBxdWVzdGlvblxuXHR9KVxuXG59KVxuXG5cbi5kaXJlY3RpdmUoJ25nUmVhbGx5Q2xpY2snLCBbZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBhdHRycy5uZ1JlYWxseU1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgJiYgY29uZmlybShtZXNzYWdlKSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoYXR0cnMubmdSZWFsbHlDbGljayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5zZXJ2aWNlKCdBbnN3ZXJzU3ZjJywgZnVuY3Rpb24gKCRodHRwKSB7XG5cdHRoaXMuY3JlYXRlID0gZnVuY3Rpb24gKGlkLCBhbnN3ZXIpIHtcbiAgXHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3F1ZXN0aW9ucycgKyBpZCwgYW5zd2VyKVxuICBcdH1cblxuICBcdHRoaXMuZmV0Y2ggPSBmdW5jdGlvbiAoaWQpIHtcbiAgXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcXVlc3Rpb25zJyArIGlkKVxuICBcdH1cblxuICBcdHRoaXMuZGVsZXRlQW5zd2VyID0gZnVuY3Rpb24ocXVlc3RJRCwgYW5zSUQpIHtcbiAgXHRcdHJldHVybiAkaHR0cC5kZWxldGUoJ2FwaS9xdWVzdGlvbnMvJyArIHF1ZXN0SUQgKyAnLycgKyBhbnNJRClcbiAgXHR9XG5cbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgVXNlclN2YywgJGxvY2F0aW9uLCAkd2luZG93KSB7XG5cdCRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHRVc2VyU3ZjLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHQudGhlbihmdW5jdGlvbiAodXNlcil7XG5cdFx0XHQkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlcilcblx0XHRcdCRsb2NhdGlvbi5wYXRoKCcvJylcblx0XHR9LFxuXHRcdGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHQkc2NvcGUuZXJyb3JNc2cgPSAnSW5jb3JyZWN0IHVzZXJuYW1lL3Bhc3N3b3JkJ1xuXHRcdH0pXG5cdH1cblxufSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb250cm9sbGVyKCdRdWVzdGlvbkRldGFpbEN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCBRdWVzdGlvbnNTdmMsICRsb2NhdGlvbikge1x0XG5cdFF1ZXN0aW9uc1N2Yy5mZXRjaE9uZSgkbG9jYXRpb24ucGF0aCgpKVxuXHQuc3VjY2VzcyhmdW5jdGlvbiAocXVlc3Rpb24pIHtcblx0XHQkc2NvcGUucXVlc3Rpb24gPSBxdWVzdGlvblx0XG5cdH0pXG5cblx0XG5cbn0pIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uY29udHJvbGxlcignUXVlc3Rpb25zQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIFF1ZXN0aW9uc1N2YywgJGxvY2F0aW9uKSB7XG4gICRzY29wZS5hc2tRdWVzdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIFF1ZXN0aW9uc1N2Yy5jcmVhdGUoe1xuICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXJuYW1lLFxuICAgICAgICB0aXRsZTogXHQgICRzY29wZS5xdWVzdGlvblRpdGxlLFxuICAgICAgICBib2R5OiAgICAgJHNjb3BlLnF1ZXN0aW9uQm9keVxuICAgICAgfSlcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChxdWVzdGlvbikge1xuICAgICAgICAkc2NvcGUucXVlc3Rpb25zLnVuc2hpZnQocXVlc3Rpb24pXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkJvZHkgPSBudWxsXG4gICAgICAgICRzY29wZS5xdWVzdGlvblRpdGxlID0gbnVsbFxuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXG4gICAgICB9KVxuICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0JHNjb3BlLmVycm9yTXNnID0gJ0FsbCBmaWVsZHMgbXVzdCBiZSBmaWxsZWQgb3V0J1xuXHQgfSlcbiAgfVxuXG4gIFF1ZXN0aW9uc1N2Yy5mZXRjaCgpXG4gIC5zdWNjZXNzKGZ1bmN0aW9uIChxdWVzdGlvbnMpIHtcbiAgICAkc2NvcGUucXVlc3Rpb25zID0gcXVlc3Rpb25zXG4gIH0pXG59KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1F1ZXN0aW9uc1N2YycsIGZ1bmN0aW9uICgkaHR0cCkge1xuICB0aGlzLmZldGNoID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcXVlc3Rpb25zLycpXG4gIH1cbiAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbiAocXVlc3Rpb24pIHtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbnMnLCBxdWVzdGlvbilcbiAgfVxuICB0aGlzLmZldGNoT25lID0gZnVuY3Rpb24gKGlkKSB7XG4gIFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9xdWVzdGlvbnMvJyArIGlkKVxuICB9XG4gIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oaWQsIHF1ZXN0aW9uKSB7XG4gIFx0cmV0dXJuICRodHRwLnB1dCgnL2FwaS9xdWVzdGlvbnMvJyArIGlkLCBxdWVzdGlvbilcbiAgfVxufSkiLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCBVc2VyU3ZjLCAkbG9jYXRpb24pIHtcbiAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIFVzZXJTdmMucmVnaXN0ZXIodXNlcm5hbWUsIHBhc3N3b3JkKVxuICAgIC50aGVuKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICBcdCRzY29wZS4kZW1pdCgnbG9naW4nLCB1c2VyKVxuXHRcdCRsb2NhdGlvbi5wYXRoKCcvJylcbiAgICB9KVxuICB9XG59KVxuIiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIpIHtcblx0JHJvdXRlUHJvdmlkZXJcblx0LndoZW4oJy8nLCB7IGNvbnRyb2xsZXI6ICdRdWVzdGlvbnNDdHJsJywgdGVtcGxhdGVVcmw6ICdxdWVzdGlvbnMuaHRtbCcgfSlcblx0LndoZW4oJy9sb2dpbicsIHsgY29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9naW4uaHRtbCcgfSlcblx0LndoZW4oJy9hc2snLCB7IGNvbnRyb2xsZXI6ICdRdWVzdGlvbnNDdHJsJywgdGVtcGxhdGVVcmw6ICdhc2suaHRtbCcgfSlcblx0LndoZW4oJy9yZWdpc3RlcicsIHsgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCcsIHRlbXBsYXRlVXJsOiAncmVnaXN0ZXIuaHRtbCcgfSlcblx0LndoZW4oJy86aWQnLCB7IGNvbnRyb2xsZXI6ICdRdWVzdGlvbkRldGFpbEN0cmwnLCB0ZW1wbGF0ZVVybDogJ3F1ZXN0aW9uRGV0YWlsLmh0bWwnIH0pXG59KSIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnNlcnZpY2UoJ1VzZXJTdmMnLCBmdW5jdGlvbiAoJGh0dHAsICR3aW5kb3cpIHtcblx0dmFyIHN2YyA9IHRoaXNcblx0c3ZjLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VycycpXG5cdFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdHJldHVybiByZXNwb25zZS5kYXRhXG5cdFx0fSlcblx0fVxuXG5cdHN2Yy5sb2dpbiA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9ucycsIHtcblx0XHRcdHVzZXJuYW1lOiB1c2VybmFtZSwgcGFzc3dvcmQ6IHBhc3N3b3JkXG5cdFx0fSkudGhlbihmdW5jdGlvbiAodmFsKSB7XG5cdFx0XHRjb25zb2xlLmxvZyh2YWwpXG5cdFx0XHRzdmMudG9rZW4gPSB2YWwuZGF0YS50b2tlblx0XG5cdFx0XHQkd2luZG93LnNlc3Npb25TdG9yYWdlLnRva2VuID0gdmFsLmRhdGFcdFx0IFxuXHRcdFx0JGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtQXV0aCddID0gdmFsLmRhdGFcblx0XHRcdHJldHVybiBzdmMuZ2V0VXNlcigpXG5cdFx0fSlcblx0fVxuXG5cdHN2Yy5sb2dvdXQgPSBmdW5jdGlvbigpIHtcblx0ICAgIC8vIEVyYXNlIHRoZSB0b2tlbiBmcm9tIHRoZSBicm93c2VyXG5cdCAgICBkZWxldGUgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZS50b2tlbjtcblx0ICAgIC8vIFJlbW92ZSBoZWFkZXIgc28gdXNlciBpcyBubyBsb25nZXIgYXV0aGVudGljYXRlZFxuXHQgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXTtcdCAgICBcblx0fTtcblxuXG5cdHN2Yy5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0ICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuXHQgICAgICB1c2VybmFtZTogdXNlcm5hbWUsIHBhc3N3b3JkOiBwYXNzd29yZFxuXHQgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG5cdCAgICAgIHJldHVybiBzdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuXHQgICAgfSlcbiAgXHR9XG5cbiAgXHRzdmMuY2hlY2tVc2VyID0gZnVuY3Rpb24gKCkge1xuICBcdFx0aWYgKCR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW4pIHsgICBcdFx0XHRcdCBcblx0XHRcdCRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUF1dGgnXSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2UudG9rZW5cblx0XHRcdHJldHVybiBzdmMuZ2V0VXNlcigpXG5cdFx0fVxuICBcdH1cblxufSkiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=